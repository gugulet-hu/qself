<head>
<!--
Transaction screen for qSelf project
Creator: Gugulethu Hlekwayo
URL: qself.gugulet.hu
This screen is for manually entering financial transactions. Inline styling is used intentionally to keep that styling close to the elements it affects. The screen uses the mapbox API, Google Fonts, and awesomplete as external resources. The opening curly brace needs to be escaped to work in Automate. Double quotes are used for Automate variables and single quotes for HTML.
-->

        <!-- Meta data to set the viewport on mobile -->
        <meta charset='UTF-8'>
        <meta name='viewport' content='width=device-width'>

        <!-- Google Fonts: import Overpass -->
        <link rel='preconnect' href='https://fonts.googleapis.com'>
        <link rel='preconnect' href='https://fonts.gstatic.com' crossorigin>
        <link href='https://fonts.googleapis.com/css2?family=Overpass:wght@400;700;900&display=swap' rel='stylesheet'>

        <!-- Awesomplete plugin -->
        <link rel='stylesheet' href='https://nico-amsterdam.github.io/awesomplete-util/css/awesomplete.css'>
        <script src='https://nico-amsterdam.github.io/awesomplete-util/js/awesomplete.min.js' async></script>
        <script src='https://nico-amsterdam.github.io/awesomplete-util/js/awesomplete-util.min.js' async></script>

        <!-- Mapbox location search script -->
        <script id='search-js' defer src='https://api.mapbox.com/search-js/v1.0.0-beta.14/web.js'></script>
        <script>
                const script = document.getElementById('search-js');
                script.onload = function () \{
                        mapboxsearch.autofill(\{
                                accessToken: '{flowConfig["mapboxAPIKey"]}'
                        });
                };
        </script>

        <!-- Script that gets the country code from Mapbox API, and returns the currency code from the Countries API -->
        <script>
                function setCurrency() \{
                        let countryCode = document.getElementById('country').value;
                        const currencyElement = document.getElementById('currency');

                        fetch('https://restcountries.com/v3.1/alpha/' + countryCode)
                                .then(response => \{
                                        if (response.ok) \{
                                                return response.json();
                                        } else \{
                                                throw new Error('API request failed');
                                        }
                                })
                                .then(data => \{
                                        let keys = Object.keys(data[0].currencies)
                                        currencyElement.value = countryCode;
                                })
                                .catch(error => \{
                                        currencyElement.value = "FUCK";
                                        console.error(error);
                                });
                }
        </script>

        <style>
                /* Standard page styling for multiple elements, inline styling for specific elements */
                body \{
                        color: #323036;
                        font-family: 'Overpass' !important;
                        text-align: center
                }

                select \{
                        border: none;
                        outline: none;
                        background-color: transparent;
                        -moz-appearance: none;
                        -webkit-appearance: none;
                        text-overflow: ellipsis;
                        overflow: hidden
                }

                select:focus \{
                        border: none;
                        outline: none
                }

                input \{
                        font-weight: 700;
                        font-size: 1em;
                        background-color: transparent;
                        border: none;
                        text-align: center;
                        float: left;
                        width: 80%;
                        -moz-appearance: none;
                        -webkit-appearance: none
                }

                input:focus \{
                        outline: none
                }

                input::-webkit-calendar-picker-indicator \{
                        display: none !important;
                }

                div.main \{
                        width: 100%
                }

                div#details > div \{
                        padding-left: 10%;
                        width: 110%;
                }

                div#details > div input \{
                        font-size: 1.2em;
                        font-weight: 400;
                        text-align: left;
                        border-bottom: 0.5px solid #E6E6E6;
                        padding: none;
                        margin: none;
                        border-left: none;
                        border-right: none;
                }

                div#numbers > div \{
                        width: 90%;
                }

                .pre-filled \{
                        text-decoration: underline dotted #CECCD2;
                }

                /* Awesomplete styling */
                .awesomplete [hidden] \{
                        display: none;
                }

                .awesomplete .visually-hidden \{
                        position: absolute;
                        clip: rect(0, 0, 0, 0);
                }

                .awesomplete \{
                        display: inline-block;
                        position: relative;
                }

                .awesomplete > input \{
                        display: block;
                }

                .awesomplete > ul \{
                        position: absolute;
                        left: 0;
                        z-index: 1;
                        min-width: 80%;
                        box-sizing: border-box;
                        list-style: none;
                        padding: 0.3em;
                        background: white;
                }

                .awesomplete > ul:empty \{
                        display: none;
                }

                .awesomplete > ul \{
                        border-radius: none;
                        background: #E6E6E6;
                        border: none;
                        box-shadow: none;
                        margin-top: 1.6em;
                        text-shadow: none;
                }

                .awesomplete > ul:before \{
                        display: none !important;
                }

                .awesomplete > ul > li \{
                        position: relative;
                        cursor: pointer;
                        text-align: left;
                        margin: 0.7em 0 0.7em 0;
                        padding: 0;
                }

                .awesomplete > ul > li:hover \{
                        background: hsl(200, 40%, 80%);
                        color: black;
                }

                .awesomplete > ul > li[aria-selected='true'] \{
                        background: #CECCD2;
                        color: #323036;
                }

                .awesomplete mark \{
                        text-decoration: underline;
                        background: none !important;
                }

                .awesomplete li:hover mark \{
                        text-decoration: underline;
                        background: none !important;
                }

                .awesomplete li[aria-selected='true'] mark \{
                        text-decoration: underline;
                        background: none !important;
                        color: inherit;
                }

                div.awesomplete \{
                        display: block
                }

                div.awesomplete ul li p \{
                        display: block;
                        font-size: 0.8em;
                        margin-left: 0.5em
                }
        </style>
</head>

<body>
        <div class='container'>
                <div class='container' style='position: absolute; top: 45%; left: 50%; margin-right: -50%; transform: translate(-50%, -50%);' >
                        <form method='get' action='http://localhost/ok' name='transactions' autocomplete='off' >

                                <div class='main' id='meta'>
                                        <div class='dateTime'>
                                                <span class='frequency' style='float: left; width:46%'>
                                                        <select style='font-weight: 900; text-align: right; text-transform: uppercase; width: 100%' name='frequency' id='frequency' >
                                                                        <option value='{todayRecurringTransaction["frequency"] ? todayRecurringTransaction["frequency"] : transaction["frequency"] ? transaction["frequency"] : "Once Off"}' selected >
                                                                                Once
                                                                        </option>
                                                                        <option value='Weekly'>Weekly</option>
                                                                        <option value='Monthly'>Monthly</option>
                                                        </select>
                                                </span><span style='float: left; width: 8%; font-size: 1em; color: #CECCD2'>::</span>
                                                <span class='dateTime' style='float: left; width:46%' >
                                                        <input style='border: none; text-align: left; width: 100%; font-weight: 400; margin-bottom: 0.8em;' type='datetime-local' id='dateTime' name='dateTime' value='{todayRecurringTransaction["dateTime"] ? xmlEncode(todayRecurringTransaction["dateTime"]) : transaction["dateTime"] ? xmlEncode(transaction["dateTime"]) : xmlEncode(dateFormat(Now,"yyyy-MM-dd'T'HH:mm"))}' class='{todayRecurringTransaction["dateTime"] ? xmlEncode(todayRecurringTransaction["dateTime"]) : transaction["dateTime"] ? "pre-filled" : ""}' required>
                                                </span>
                                        </div>
                                        <br>
                                        <br>
                                        <div class='accounts'>
                                                <span class='accountFrom' style='float: left; width:46%' >
                                                        <select name='accountFrom' id='accountFrom' style='text-align:right; font-weight: 700 !important; font-size: 1em; width: 100%' class='{todayRecurringTransaction["accountFrom"] ? todayRecurringTransaction["accountFrom"] : transaction["accountFrom"] ? "pre-filled" : ""}' required>
                                                                <option value='{todayRecurringTransaction["accountFrom"] ? todayRecurringTransaction["accountFrom"] : transaction["accountFrom"] ? transaction["accountFrom"] : "Revolut Current"}' selected>
                                                                        {todayRecurringTransaction["accountFrom"] ? todayRecurringTransaction["accountFrom"] : transaction["accountFrom"] ? transaction["accountFrom"] : "Revolut Current"}
                                                                </option>
                                                                {transactionLists["accountTo"]}
                                                        </select>
                                                </span>
                                                <span style='float: left; width: 8%; font-size: 1em; color: #CECCD2'>::</span>
                                                <span class='accountTo' style='float: left; width:46%'>
                                                        <select name='accountTo' id='accountTo' style='text-align:left; font-weight: 700 !important; font-size: 1em' class='{todayRecurringTransaction["accountTo"] ? todayRecurringTransaction["accountTo"] : transaction["accountTo"] ? "pre-filled" : ""}'  required>
                                                                <option value='{todayRecurringTransaction["accountTo"] ? todayRecurringTransaction["accountTo"] : transaction["accountTo"] ? transaction["accountTo"] : "Expenses"}' selected>
                                                                        {todayRecurringTransaction["accountTo"] ? todayRecurringTransaction["accountTo"] : transaction["accountTo"] ? transaction["accountTo"] : "Expenses"}
                                                                </option>
                                                                {transactionLists["accountTo"]}
                                                        </select>
                                                </span>
                                        </div>
                                        <br>
                                        <br>
                                        <div class='details'>
                                                <span class='type' style='float: left; width: 46%' >
                                                        <select name='type' id='type' style='text-align: right; font-size: 1em; width: 100%; padding: 0' class='{todayRecurringTransaction["category"] ? todayRecurringTransaction["category"] : transaction["category"] ? "pre-filled" : ""}'  required>
                                                                <option value='{todayRecurringTransaction["category"] ? todayRecurringTransaction["category"] : transaction["category"] ? transaction["category"] : "Food"}' selected>{todayRecurringTransaction["category"] ?todayRecurringTransaction["category"] : transaction["category"] ? transaction["category"] : "Food"}</option>
                                                                {transactionLists["category"]}
                                                        </select>
                                                </span>
                                                <span style='float: left; width: 8%; font-size: 1em; color: #CECCD2'>::</span>
                                                <span class='group' style='float: left; width: 46%' >
                                                        <input name='group' id='group' class='awesomplete' list='transactionGroup' style='text-align: left; font-size: 1em; font-weight: 400 !important' class='{todayRecurringTransaction["group"] ? todayRecurringTransaction["group"] : transaction["group"] ? "pre-filled" : ""}' placeholder='Enter subcategory' data-maxitems='1' data-autofirst='true' data-tabSelect='true' required />
                                                                <datalist id='transactionGroup'>{transactionLists["subcategory"]}</datalist>
                                                </span>
                                        </div>
                                </div>
                                <br>
                                <br>
                                <br>
                                <br>

                                <div id='details' class='main'>
                                        <div class='brand'>
                                                <input class='awesomplete' list='transactionBrand' name='brand' id='brand' placeholder='{todayRecurringTransaction["brand"] ? todayRecurringTransaction["brand"] : transaction["brand"] ? transaction["brand"] : "Brand"}' value='{todayRecurringTransaction["brand"] ? todayRecurringTransaction["brand"] : transaction["brand"] ? transaction["brand"] : ""}' data-maxitems='1' data-autofirst='true' data-tabSelect='true' required>
                                                        <datalist id='transactionBrand'>{transactionLists["brand"]}</datalist>
                                        </div>
                                        <br>
                                        <br>
                                        <br>
                                        <div class='item'>
                                                <input class='awesomplete' list='transactionItem' name='item' id='item' value='{todayRecurringTransaction["item"] ? todayRecurringTransaction["item"] : transaction["item"] ? transaction["item"] : ""}' placeholder='{todayRecurringTransaction["item"] ? todayRecurringTransaction["item"] : transaction["item"] ? transaction["item"] : "Item"}' data-maxitems='5' data-autofirst='true' data-tabSelect='true' required>
                                                        <datalist id='transactionItem'>{transactionLists["item"]}</datalist>
                                        </div>
                                        <br>
                                        <br>
                                        <br>
                                        <div class='location' style='text-align: left'>
                                                <input name='address' placeholder='{todayRecurringTransaction["address"] ? todayRecurringTransaction["address"] : transaction["address"] ? transaction["address"] : "Address"}' value='{todayRecurringTransaction["address"] ? todayRecurringTransaction["address"] : transaction["address"] ? transaction["address"] : ""}'type='text' class='{todayRecurringTransaction["address"] ? todayRecurringTransaction["address"] : transaction["address"] ? "pre-filled" : ""}' autocomplete='address-line1' onblur='setCurrency()' required />
                                                <input name='city' placeholder='{todayRecurringTransaction["city"] ? todayRecurringTransaction["city"] : transaction["city"] ? transaction["city"] : "City"}' value='{todayRecurringTransaction["city"] ? todayRecurringTransaction["city"] : transaction["city"] ? transaction["city"] : ""}' type='text' style='visibility:hidden' autocomplete='address-level2' />
                                                <input name='country' id='country' placeholder='{todayRecurringTransaction["country"] ? todayRecurringTransaction["country"] : transaction["country"] ? transaction["country"] : "Country"}' value='{todayRecurringTransaction["country"] ? todayRecurringTransaction["country"] : transaction["country"] ? transaction["country"] : ""}' type='text' style='visibility:hidden' autocomplete='country' />
                                                <input name='postcode' placeholder='{todayRecurringTransaction["postcode"] ? todayRecurringTransaction["postcode"] : transaction["postcode"] ? transaction["postcode"] : "Postcode"}' value='{todayRecurringTransaction["postcode"] ? todayRecurringTransaction["postcode"] : transaction["postcode"] ? transaction["postcode"] : ""}' type='text' style='visibility:hidden' autocomplete='postal-code' />
                                        </div>
                                </div>
                                <br>

                                <div id='numbers' class='main' >
                                        <div class='quantity' style='margin-bottom: 0.8em; text-align: right'>
                                                <span class='quantityNumber'>
                                                        <input type='number' id='quantity' style='float: none; font-weight: 400 !important; font-size: 1.2em; text-align: right;width: 70%' step='.01' name='quantity' min='0.01' placeholder='{todayRecurringTransaction["quantity"] ? todayRecurringTransaction["quantity"] : transaction["quantity"] ? transaction["quantity"] : "0.00"}' value='{todayRecurringTransaction["quantity"] ? todayRecurringTransaction["quantity"] : transaction["quantity"] ? transaction["quantity"] : ""}' required>
                                                </span>
                                                <span class='quantityUnit'>
                                                        <select name='quantityUnit' required>
                                                                <option value='{todayRecurringTransaction["quantityUnit"] ? todayRecurringTransaction["quantityUnit"] : transaction["quantityUnit"] ? transaction["quantityUnit"] : "x"}' selected>
                                                                        {todayRecurringTransaction["quantityUnit"] ? todayRecurringTransaction["quantityUnit"] : transaction["quantityUnit"] ? transaction["quantityUnit"] : "x"}
                                                                </option>
                                                                {transactionLists["quantityUnit"]}
                                                        </select>
                                                </span>
                                        </div>
                                        <div class='costs'>
                                                <span class='currency' style='float: left; width: 20%;' >
                                                        <input name='currency' id='currency' style='font-weight: 700; font-size: 0.8em; text-transform: uppercase' value= 'EUR' >
                                                </span>
                                                <span class='amount'>
                                                        <input type='number' id='amount' style='float: none; font-weight: 900; font-size: 3.5em; text-align: right; width: 80%;padding-bottom: 10px' step='.01' name='amount' min='0.01' placeholder='{todayRecurringTransaction["amount"] ? todayRecurringTransaction["amount"] : transaction["amount"] ? transaction["amount"] : "0.01"}' value='{todayRecurringTransaction["amount"] ? todayRecurringTransaction["amount"] : transaction["amount"] ? transaction["amount"] : ""}' required>
                                                </span>
                                        </div>
                                        <input type='submit' action='http://localhost/ok' hidden />
                                </div>
                        </form>
                </div>
        </div>
</body>
